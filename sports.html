<div id="baseball" class="content active">
    <h2>MLB Leaderboards (2024)</h2>
    <button onclick="fetchAllStats()">Update Stats</button>

    <div id="statsContainer">
        <h3>Batting Average</h3>
        <table border="1" id="battingAvgTable">
            <thead><tr><th>Rank</th><th>Player</th><th>AVG</th></tr></thead>
            <tbody><tr><td colspan="3">Loading...</td></tr></tbody>
        </table>

        <h3>On-Base Percentage (OBP)</h3>
        <table border="1" id="obpTable">
            <thead><tr><th>Rank</th><th>Player</th><th>OBP</th></tr></thead>
            <tbody><tr><td colspan="3">Loading...</td></tr></tbody>
        </table>

        <h3>Slugging Percentage (SLG)</h3>
        <table border="1" id="slgTable">
            <thead><tr><th>Rank</th><th>Player</th><th>SLG</th></tr></thead>
            <tbody><tr><td colspan="3">Loading...</td></tr></tbody>
        </table>

        <h3>Home Runs (HR)</h3>
        <table border="1" id="hrTable">
            <thead><tr><th>Rank</th><th>Player</th><th>HR</th></tr></thead>
            <tbody><tr><td colspan="3">Loading...</td></tr></tbody>
        </table>

        <h3>Stolen Bases (SB)</h3>
        <table border="1" id="sbTable">
            <thead><tr><th>Rank</th><th>Player</th><th>SB</th></tr></thead>
            <tbody><tr><td colspan="3">Loading...</td></tr></tbody>
        </table>
    </div>
</div>

<script>
    const statsList = {
        "Batting Average": "battingAvgTable",
        "On-Base Percentage": "obpTable",
        "Slugging Percentage": "slgTable",
        "Home Runs": "hrTable",
        "Stolen Bases": "sbTable"
    };

    function fetchAllStats() {
        Object.entries(statsList).forEach(([stat, tableId]) => {
            fetch(`http://127.0.0.1:5000/api/mlb-stats?stat=${encodeURIComponent(stat)}`)
                .then(response => response.json())
                .then(data => {
                    let tableBody = document.querySelector(`#${tableId} tbody`);
                    tableBody.innerHTML = "";

                    if (data.length === 0 || data[0].error) {
                        tableBody.innerHTML = `<tr><td colspan="3">Error fetching stats.</td></tr>`;
                        return;
                    }

                    data.forEach((player, index) => {
                        let row = `<tr>
                            <td>${index + 1}</td>
                            <td>${player.player}</td>
                            <td>${player.stat}</td>
                        </tr>`;
                        tableBody.innerHTML += row;
                    });
                })
                .catch(error => {
                    console.error("Error fetching data:", error);
                    document.querySelector(`#${tableId} tbody`).innerHTML = "<tr><td colspan='3'>Failed to load stats.</td></tr>";
                });
        });
    }

    document.addEventListener("DOMContentLoaded", fetchAllStats);
</script>
